--- genostream/cli.py	2025-12-13 07:25:53.998251343 +0000
+++ genostream/cli.py	2025-12-13 07:39:43.006849673 +0000
@@ -28,6 +28,22 @@
     v = getattr(args, "min_orf_aa", None)
     return int(v if v is not None else train_cfg.min_orf_aa)
 
+def _bool_opt(v, default: bool) -> bool:
+    return default if v is None else bool(v)
+
+
+def _get_protein_opts(args, train_cfg):
+    """Options used for aa+genbank CDS extraction and filtering."""
+    return {
+        "protein_strict_cds_only": _bool_opt(getattr(args, "strict_cds", None), getattr(train_cfg, "protein_strict_cds_only", False)),
+        "protein_require_translation": _bool_opt(getattr(args, "require_translation", None), getattr(train_cfg, "protein_require_translation", False)),
+        "protein_reject_partial": _bool_opt(getattr(args, "reject_partial_cds", None), getattr(train_cfg, "protein_reject_partial", True)),
+        "protein_require_start_m": _bool_opt(getattr(args, "require_start_m", None), getattr(train_cfg, "protein_require_start_m", True)),
+        "protein_x_free": _bool_opt(getattr(args, "x_free", None), getattr(train_cfg, "protein_x_free", True)),
+        "protein_min_aa": int(getattr(args, "min_protein_aa", None) if getattr(args, "min_protein_aa", None) is not None else getattr(train_cfg, "protein_min_aa", getattr(train_cfg, "min_orf_aa", 90))),
+        "protein_max_aa": int(getattr(args, "max_protein_aa", None) if getattr(args, "max_protein_aa", None) is not None else getattr(train_cfg, "protein_max_aa", 5000)),
+    }
+
 
 def _get_source(args, tok: str) -> str:
     v = getattr(args, "source", None)
@@ -121,19 +137,23 @@
     _validate_tok_params(tok, window_size, stride, frame)
 
     src = _get_source(args, tok)
+
+    protein_opts = _get_protein_opts(args, train_cfg) if (tok == 'aa' and src == 'genbank') else {}
     _ensure_record(args.accession, src, io_cfg=io_cfg, ncbi_cfg=ncbi_cfg, force=False)
 
     out_path = encoded_cache_path(
         io_cfg, args.accession, tok, window_size, stride, frame,
         source=src,
         min_orf_aa=(min_orf if tok=="aa" else None),
+        **protein_opts
     )
     encoded = encode_accession(
         args.accession, io_cfg, window_size, stride,
         tokenizer=tok, frame_offset=frame, min_orf_aa=min_orf,
         source=src,
-        save_to_disk=True, out_path=out_path
-    )
+        save_to_disk=True, out_path=out_path,
+            **protein_opts
+        )
     print(f"{args.accession}: encoded tokenizer={tok} source={src} -> shape={encoded.shape} saved={out_path}")
     return 0
 
@@ -152,6 +172,8 @@
 
     src = _get_source(args, tok)
 
+    protein_opts = _get_protein_opts(args, train_cfg) if (tok == 'aa' and src == 'genbank') else {}
+
     batch_size = args.batch_size or train_cfg.batch_size
     steps = args.steps or train_cfg.steps_per_plasmid
 
@@ -161,6 +183,7 @@
         io_cfg, args.accession, tok, window_size, stride, frame,
         source=src,
         min_orf_aa=(min_orf if tok=="aa" else None),
+        **protein_opts
     )
     if os.path.exists(enc_path) and not args.reencode:
         encoded = np.load(enc_path)
@@ -170,7 +193,8 @@
             args.accession, io_cfg, window_size, stride,
             tokenizer=tok, frame_offset=frame, min_orf_aa=min_orf,
             source=src,
-            save_to_disk=True, out_path=enc_path
+            save_to_disk=True, out_path=enc_path,
+            **protein_opts
         )
 
     last_total = train_on_encoded(
@@ -204,12 +228,15 @@
     _validate_tok_params(tok, window_size, stride, frame)
 
     src = _get_source(args, tok)
+
+    protein_opts = _get_protein_opts(args, train_cfg) if (tok == 'aa' and src == 'genbank') else {}
     _ensure_record(args.accession, src, io_cfg=io_cfg, ncbi_cfg=ncbi_cfg, force=False)
 
     enc_path = encoded_cache_path(
         io_cfg, args.accession, tok, window_size, stride, frame,
         source=src,
         min_orf_aa=(min_orf if tok=="aa" else None),
+        **protein_opts
     )
     if os.path.exists(enc_path) and not args.reencode:
         encoded = np.load(enc_path)
@@ -218,7 +245,8 @@
             args.accession, io_cfg, window_size, stride,
             tokenizer=tok, frame_offset=frame, min_orf_aa=min_orf,
             source=src,
-            save_to_disk=True, out_path=enc_path
+            save_to_disk=True, out_path=enc_path,
+            **protein_opts
         )
 
     errors = compute_window_errors(
@@ -258,6 +286,8 @@
     _validate_tok_params(tok, window_size, stride, frame)
 
     src = _get_source(args, tok)
+
+    protein_opts = _get_protein_opts(args, train_cfg) if (tok == 'aa' and src == 'genbank') else {}
     _ensure_record(args.accession, src, io_cfg=io_cfg, ncbi_cfg=ncbi_cfg, force=False)
 
     steps = args.steps or train_cfg.steps_per_plasmid
@@ -267,6 +297,7 @@
         io_cfg, args.accession, tok, window_size, stride, frame,
         source=src,
         min_orf_aa=(min_orf if tok=="aa" else None),
+        **protein_opts
     )
     if os.path.exists(enc_path) and not args.reencode:
         encoded = np.load(enc_path)
@@ -275,7 +306,8 @@
             args.accession, io_cfg, window_size, stride,
             tokenizer=tok, frame_offset=frame, min_orf_aa=min_orf,
             source=src,
-            save_to_disk=True, out_path=enc_path
+            save_to_disk=True, out_path=enc_path,
+            **protein_opts
         )
 
     metric = compute_gc_from_encoded(encoded, tokenizer=tok)
@@ -342,6 +374,8 @@
 
     src = _get_source(args, tok)
 
+    protein_opts = _get_protein_opts(args, train_cfg) if (tok == 'aa' and src == 'genbank') else {}
+
     batch_size = args.batch_size or train_cfg.batch_size
     steps_per_plasmid = args.steps_per_plasmid or train_cfg.steps_per_plasmid
     max_epochs = args.max_epochs or train_cfg.max_stream_epochs
@@ -362,6 +396,7 @@
                 io_cfg, acc, tok, window_size, stride, frame,
                 source=src,
                 min_orf_aa=(min_orf if tok=="aa" else None),
+                **protein_opts
             )
             if os.path.exists(enc_path):
                 encoded = np.load(enc_path)
@@ -370,8 +405,9 @@
                     acc, io_cfg, window_size, stride,
                     tokenizer=tok, frame_offset=frame, min_orf_aa=min_orf,
                     source=src,
-                    save_to_disk=True, out_path=enc_path
-                )
+                    save_to_disk=True, out_path=enc_path,
+                **protein_opts
+            )
 
             _ = train_on_encoded(
                 acc, encoded,
@@ -472,6 +508,20 @@
         sp.add_argument("--frame-offset", type=int, choices=[0,1,2], default=None, help="Codon frame offset (default from config)")
         sp.add_argument("--min-orf-aa", type=int, default=None, help="AA tokenizer: minimum ORF length in amino acids (default from config)")
         sp.add_argument("--source", choices=["fasta","genbank"], default=None, help="Sequence record source. Default: fasta for base/codon, genbank for aa.")
+        sp.add_argument("--strict-cds", action=argparse.BooleanOptionalAction, default=None,
+                        help="AA+GenBank: if enabled, require CDS proteins and DISABLE naive ORF fallback.")
+        sp.add_argument("--require-translation", action=argparse.BooleanOptionalAction, default=None,
+                        help="AA+GenBank: if enabled, only accept CDS entries with /translation qualifier.")
+        sp.add_argument("--reject-partial-cds", dest="reject_partial_cds", action=argparse.BooleanOptionalAction, default=None,
+                        help="AA+GenBank: reject CDS with partial endpoints (< or >) in location.")
+        sp.add_argument("--require-start-m", action=argparse.BooleanOptionalAction, default=None,
+                        help="AA+GenBank: require proteins start with 'M'.")
+        sp.add_argument("--x-free", action=argparse.BooleanOptionalAction, default=None,
+                        help="AA+GenBank: reject proteins containing 'X'.")
+        sp.add_argument("--min-protein-aa", dest="min_protein_aa", type=int, default=None,
+                        help="AA+GenBank: minimum protein length in aa (default from config).")
+        sp.add_argument("--max-protein-aa", dest="max_protein_aa", type=int, default=None,
+                        help="AA+GenBank: maximum protein length in aa (default from config).")
 
     def add_loss_args(sp):
         sp.add_argument(
